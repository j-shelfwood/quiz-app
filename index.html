<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Quiz</title>
		<link
			href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css"
			rel="stylesheet"
		/>
		<style>
			.hide {
				display: none;
			}
		</style>
	</head>
	<body class="bg-gray-100 min-h-screen">
		<div id="setup" class="container mx-auto px-4 py-10 text-center">
			<h2 class="text-2xl mb-6">Enter the quiz JSON and name:</h2>
			<!-- Add this dropdown menu inside the setup div -->
			<select
				id="quizSelect"
				class="w-full mb-4 p-2 border border-gray-300 rounded"
			>
				<option value="">Select a previously added quiz</option>
			</select>
			<!-- Add this delete button inside the setup div -->
			<button
				id="deleteBtn"
				class="ml-2 px-4 py-1 bg-red-500 hover:bg-red-700 text-white rounded"
			>
				Delete
			</button>

			<p class="text-xl mb-6">or</p>

			<input
				type="text"
				id="quizName"
				class="w-full mb-4 p-2 border border-gray-300 rounded"
				placeholder="Enter quiz name"
			/>
			<textarea
				id="jsonInput"
				class="w-full mb-6 p-2 border border-gray-300 rounded"
				rows="10"
				placeholder="Paste quiz JSON here"
			></textarea>

			<button
				id="startBtn"
				class="px-6 py-2 bg-blue-500 hover:bg-blue-700 text-white rounded"
			>
				Start Quiz
			</button>
		</div>
		<div id="quiz" class="container mx-auto px-4 py-10">
			<div id="questionContainer" class="text-center">
				<h2 id="question" class="text-2xl mb-6"></h2>
				<div id="options" class="space-y-4"></div>
				<button
					id="nextBtn"
					class="mt-6 px-6 py-2 bg-blue-500 hover:bg-blue-700 text-white rounded"
				>
					Next
				</button>
			</div>
			<div id="result" class="text-center hide">
				<h2 class="text-2xl mb-6">Your score:</h2>
				<p id="score" class="text-xl mb-6"></p>
				<button
					id="restartBtn"
					class="px-6 py-2 bg-blue-500 hover:bg-blue-700 text-white rounded"
				>
					Restart
				</button>
			</div>
		</div>

		<script>
			let quizData;

			let currentQuestion = 0;
			let score = 0;

			const questionEl = document.getElementById("question");
			const optionsEl = document.getElementById("options");
			const nextBtn = document.getElementById("nextBtn");
			const resultEl = document.getElementById("result");
			const questionContainer =
				document.getElementById("questionContainer");
			const scoreEl = document.getElementById("score");
			const restartBtn = document.getElementById("restartBtn");
			const setupEl = document.getElementById("setup");
			const quizNameEl = document.getElementById("quizName");
			const jsonInputEl = document.getElementById("jsonInput");
			const startBtn = document.getElementById("startBtn");
			// Add previously added quizzes to the dropdown menu
			function populateQuizSelect() {
				const quizSelect = document.getElementById("quizSelect");
				const storedQuizzes = Object.keys(localStorage).filter((key) =>
					key.startsWith("quiz_")
				);

				storedQuizzes.forEach((quizName) => {
					const option = document.createElement("option");
					option.value = quizName;
					option.textContent = quizName.replace("quiz_", "");
					quizSelect.appendChild(option);
				});
			}
			populateQuizSelect();

			const deleteBtn = document.getElementById("deleteBtn");
			deleteBtn.addEventListener("click", () => {
				const quizSelect = document.getElementById("quizSelect");
				const selectedQuiz = quizSelect.value;

				if (!selectedQuiz) {
					alert("Please select a quiz to delete.");
					return;
				}

				if (confirm("Are you sure you want to delete this quiz?")) {
					localStorage.removeItem(selectedQuiz);
					quizSelect.remove(quizSelect.selectedIndex);
				}
			});

			// Rest of the script remains the same until the startQuiz function

			function startQuiz() {
				const selectedQuiz =
					document.getElementById("quizSelect").value;
				const quizName = quizNameEl.value.trim();
				const jsonString = jsonInputEl.value.trim();

				if (selectedQuiz) {
					quizData = JSON.parse(localStorage.getItem(selectedQuiz));
				} else {
					if (!quizName || !jsonString) {
						alert("Please enter a quiz name and paste quiz JSON.");
						return;
					}

					try {
						quizData = JSON.parse(jsonString);
						localStorage.setItem("quiz_" + quizName, jsonString);
						populateQuizSelect();
					} catch (error) {
						alert("Invalid JSON format. Please check your input.");
						return;
					}
				}

				setupEl.classList.add("hide");
				quiz.classList.remove("hide");
				loadQuestion();
			}

			startBtn.addEventListener("click", startQuiz);

			function loadQuestion() {
				const questionData = quizData.questions[currentQuestion];
				questionEl.textContent = questionData.question;
				optionsEl.innerHTML = "";

				questionData.options.forEach((option) => {
					const button = document.createElement("button");
					button.innerText = option;
					button.classList.add(
						"w-full",
						"bg-white",
						"rounded",
						"p-2",
						"text-left",
						"hover:bg-gray-200"
					);
					optionsEl.appendChild(button);

					button.addEventListener("click", () => {
						if (option === questionData.answer) {
							score++;
							button.classList.add("bg-green-500");
						} else {
							button.classList.add("bg-red-500");
						}
						setTimeout(() => nextQuestion(), 1000);
					});
				});
			}

			function nextQuestion() {
				currentQuestion++;
				if (currentQuestion >= quizData.questions.length) {
					showResults();
				} else {
					loadQuestion();
				}
			}

			function showResults() {
				questionContainer.classList.add("hide");
				resultEl.classList.remove("hide");
				scoreEl.textContent = `${score} / ${quizData.questions.length}`;
			}

			function restartQuiz() {
				resultEl.classList.add("hide");
				questionContainer.classList.remove("hide");
				score = 0;
				currentQuestion = 0;
				startQuiz();
			}

			nextBtn.addEventListener("click", nextQuestion);
			restartBtn.addEventListener("click", restartQuiz);
		</script>
	</body>
</html>
